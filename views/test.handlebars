

  
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script>
	
var templates = ['_o_','(_o_)o_','_o(_o_)'];
var numsw = [1,2,3,4,5,6,7,8,9];
var opsw = ['*','+','-'];



  function evalExpr(express){
    return(Math.round(eval(express)*10)/10);
  }

  function getAllIndexes(str, val) {
    var indexes = [], i;
    for(i = 0; i < str.length; i++)
        if (str[i] === val)
            indexes.push(i);
    return indexes;
  }

  function get4RandomNumbers(val){
    var rand = [];
    var tempNum = Math.floor(Math.random()*100);
    while(rand.length < 4){
      while(Math.abs(val-tempNum) > 10 || rand.indexOf(tempNum) != -1 || tempNum == val || tempNum == 0){
        tempNum = Math.floor(Math.random()*100);
      }
      rand.push(tempNum);
    }
    return rand;
  }

  function _getRandomOperation(pos){
    var pos = pos || 0;
    var tempExp = '';
    var nums = numsw.slice();
    var ops = opsw.slice();
    var min = 0;
    var max = 100;
    var value = 0;
    var solPos,
        solValue,
        filled;
    
    var actTemplate = templates[Math.floor(Math.random()*templates.length)]

    for (var i = 0; i < actTemplate.length; i++) {
      var tempChar = actTemplate.charAt(i);
      if(tempChar == '_'){
        var tempN = nums.splice(Math.floor(Math.random()*nums.length),1)[0];
        tempExp += tempN;
      }
      else if(tempChar == 'o'){
        var tempN = ops.splice(Math.floor(Math.random()*ops.length),1)[0];
        tempExp += tempN;
      }
      else{
        tempExp += tempChar;
      }
    }

    value = value || evalExpr(tempExp)

    if((value < min || value > max) && pos < 1000){
      return _getRandomOperation(pos+1);
    }
    else{     
      solPos = getAllIndexes(actTemplate,'_').concat(['end']).sort(function(){return 0.5 - Math.random()})[0];
      solValue = solPos == 'end' ? value : tempExp.charAt(solPos);
      tempExp = solPos == 'end' ? tempExp : tempExp.substr(0, solPos) + '_' + tempExp.substr(solPos+1,tempExp.length);
      filled = get4RandomNumbers(solValue).concat(solValue).sort(function(){return 0.5 - Math.random()});

      return [[solPos == 'end' ? tempExp + '=_' : tempExp + '=' + value, filled.toString()].toString(), solValue];
    }
  };

  for (var i = 0; i < 100; i++) {
  	console.log('_getRandomOperation:', _getRandomOperation());
  }
</script>

